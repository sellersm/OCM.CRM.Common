<EditDataFormTemplateSpec 
    xmlns:c="bb_appfx_commontypes"
    ID="276a7de5-55b2-495f-b6c8-ba13f9967289"
    Name="Interaction Extension Edit Form"
    Description="Used for editing the given Interaction Extension"
    Author="Cary Mayeda"
    RecordType="Constituent Interaction"
    DataFormInstanceID="8a45eb34-36e6-489d-aa5e-9af0402eb055"
    c:SecurityUIFolder="Interaction Extension"
    OwnerIDMapperID="00000000-0000-0000-0000-000000000000"
    xmlns="bb_appfx_editdataformtemplate"
    >
    <SPDataForm>
        <LoadImplementation SPName="USP_DATAFORMTEMPLATE_EDITLOAD_INTERACTION_EXTENSION">
            <c:CreateProcedureSQL>
<![CDATA[
create procedure dbo.USP_DATAFORMTEMPLATE_EDITLOAD_INTERACTION_EXTENSION
(
    @ID uniqueidentifier,
    @DATALOADED bit = 0 output,
    @TSLONG bigint = 0 output,
    @LETTERTYPECODEID uniqueidentifier = null output,
    @LETTERCHILDVERSIONCODEID uniqueidentifier = null output,
    @FULFILLMENTSTATUSCODEID uniqueidentifier = null output,
    @RESENDCODE tinyint = null output,
    @EFTBROCHURE bit = null output,
    @DEPARTEDCHILDID uniqueidentifier = null output,
    @UNAVILABLECHILDID uniqueidentifier = null output,
    @DOUBLESPONSOREDCHILDID uniqueidentifier = null output,
    @TRANSFERCHILDID uniqueidentifier = null output,
    @PREVIOUSCHILDPROJECTID uniqueidentifier = null output,
    @PREVIOUSBIRTHDATE datetime = null output,
    @PREVIOUSNAME nvarchar(150) = null output,
	@CHILDREN xml = null output
)
as

	set nocount on;

	-- be sure to set these, in case the select returns no rows
	set @DATALOADED = 0
	set @TSLONG = 0

	-- populate the output parameters, which correspond to fields on the form.  Note that
	-- we set @DATALOADED = 1 to indicate that the load was successful.  Otherwise, the system
	-- will display a "no data loaded" message.  Also note that we fetch the TSLONG so that concurrency
	-- can be considered.
	select
		@DATALOADED = 1,
		@TSLONG = TSLONG,
        @LETTERTYPECODEID = LETTERTYPECODEID, 
        @LETTERCHILDVERSIONCODEID = LETTERCHILDVERSIONCODEID, 
        @FULFILLMENTSTATUSCODEID = FULFILLMENTSTATUSCODEID, 
        @RESENDCODE = RESENDCODE, 
        @EFTBROCHURE = EFTBROCHURE, 
        @DEPARTEDCHILDID = DEPARTEDCHILDID, 
        @UNAVILABLECHILDID = UNAVILABLECHILDID, 
        @DOUBLESPONSOREDCHILDID = DOUBLESPONSOREDCHILDID, 
        @TRANSFERCHILDID = TRANSFERCHILDID, 
        @PREVIOUSCHILDPROJECTID = PREVIOUSCHILDPROJECTID, 
        @PREVIOUSBIRTHDATE = PREVIOUSBIRTHDATE, 
        @PREVIOUSNAME = PREVIOUSNAME,
		@CHILDREN = dbo.USR_UFN_INTERACTIONEXTENSION_GETCHILDREN_TOITEMLISTXML(@ID)
	from dbo.USR_INTERACTIONEXTENSION
	where ID = @ID

	return 0;
]]>
</c:CreateProcedureSQL>
        </LoadImplementation>
        <SaveImplementation SPName="USP_DATAFORMTEMPLATE_EDIT_INTERACTION_EXTENSION">
            <c:CreateProcedureSQL>
<![CDATA[
create procedure dbo.USP_DATAFORMTEMPLATE_EDIT_INTERACTION_EXTENSION
(
	@ID uniqueidentifier,
	@CHANGEAGENTID uniqueidentifier = null,
    @LETTERTYPECODEID uniqueidentifier,
    @LETTERCHILDVERSIONCODEID uniqueidentifier,
    @FULFILLMENTSTATUSCODEID uniqueidentifier,
    @RESENDCODE tinyint,
    @EFTBROCHURE bit,
    @DEPARTEDCHILDID uniqueidentifier,
    @UNAVILABLECHILDID uniqueidentifier,
    @DOUBLESPONSOREDCHILDID uniqueidentifier,
    @TRANSFERCHILDID uniqueidentifier,
    @PREVIOUSCHILDPROJECTID uniqueidentifier,
    @PREVIOUSBIRTHDATE datetime,
    @PREVIOUSNAME nvarchar(150),
	@CHILDREN xml
)
as

	set nocount on;

	if @changeAgentID is null  
		exec dbo.USP_CHANGEAGENT_GETORCREATECHANGEAGENT @changeAgentID output

	declare @currentDate datetime
	set @currentDate= getdate()						
	
	begin try
		-- handle updating the data
		update dbo.USR_INTERACTIONEXTENSION set
            LETTERTYPECODEID = @LETTERTYPECODEID,
            LETTERCHILDVERSIONCODEID = @LETTERCHILDVERSIONCODEID,
            FULFILLMENTSTATUSCODEID = @FULFILLMENTSTATUSCODEID,
            RESENDCODE = @RESENDCODE,
            EFTBROCHURE = @EFTBROCHURE,
            DEPARTEDCHILDID = @DEPARTEDCHILDID,
            UNAVILABLECHILDID = @UNAVILABLECHILDID,
            DOUBLESPONSOREDCHILDID = @DOUBLESPONSOREDCHILDID,
            TRANSFERCHILDID = @TRANSFERCHILDID,
            PREVIOUSCHILDPROJECTID = @PREVIOUSCHILDPROJECTID,
            PREVIOUSBIRTHDATE = @PREVIOUSBIRTHDATE,
            PREVIOUSNAME = @PREVIOUSNAME,

			CHANGEDBYID = @changeAgentID,
			DATECHANGED = @currentDate
		where ID = @ID
		
		exec dbo.USR_USP_INTERACTIONEXTENSION_GETCHILDREN_UPDATEFROMXML @ID, @CHILDREN, @changeAgentID, @currentDate
		
	end try
	begin catch
		exec dbo.USP_RAISE_ERROR
		return 1
	end catch

return 0;
]]>
</c:CreateProcedureSQL>
            <c:ExpectedDBExceptions>
                <c:Constraints>
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_LETTERTYPECODEID" Field="LETTERTYPECODEID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_LETTERCHILDVERSIONCODEID" Field="LETTERCHILDVERSIONCODEID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_FULFILLMENTSTATUSCODEID" Field="FULFILLMENTSTATUSCODEID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_DEPARTEDCHILDID" Field="DEPARTEDCHILDID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_UNAVILABLECHILDID" Field="UNAVILABLECHILDID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_DOUBLESPONSOREDCHILDID" Field="DOUBLESPONSOREDCHILDID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_TRANSFERCHILDID" Field="TRANSFERCHILDID" Type="ForeignKey" />
                    <c:Constraint Name="FK_USR_INTERACTIONEXTENSION_PREVIOUSCHILDPROJECTID" Field="PREVIOUSCHILDPROJECTID" Type="ForeignKey" />
                </c:Constraints>
            </c:ExpectedDBExceptions>
        </SaveImplementation>		
    </SPDataForm>

	
	<c:FormMetaData FixedDialog="true">
        <c:FormFields>
            <c:FormField FieldID="LETTERTYPECODEID" DataType="Guid" Caption="Letter type">
                <c:CodeTable CodeTableName="USR_INTERACTIONEXTENSIONLETTERTYPECODE" />
            </c:FormField>
            <c:FormField FieldID="LETTERCHILDVERSIONCODEID" DataType="Guid" Caption="Letter child version">
                <c:CodeTable CodeTableName="USR_INTERACTIONEXTENSIONLETTERCHILDVERSIONCODE" />
            </c:FormField>
            <c:FormField FieldID="FULFILLMENTSTATUSCODEID" DataType="Guid" Caption="Fulfillment status">
                <c:CodeTable CodeTableName="USR_INTERACTIONEXTENSIONFULFILLMENTSTATUSCODE" />
            </c:FormField>
            <c:FormField FieldID="RESENDCODE" DataType="TinyInt" Caption="Resend?" DefaultValueText="0">
                <c:ValueList>
                    <c:Items>
                        <c:Item>
                            <c:Value>0</c:Value>
                            <c:Label>No</c:Label>
                        </c:Item>
                        <c:Item>
                            <c:Value>1</c:Value>
                            <c:Label>Yes</c:Label>
                        </c:Item>
                    </c:Items>
                </c:ValueList>
            </c:FormField>
            <c:FormField FieldID="EFTBROCHURE" DataType="Boolean" Caption="EFT brochure" />
            <c:FormField FieldID="DEPARTEDCHILDID" DataType="Guid" Caption="Departed child" />
            <c:FormField FieldID="UNAVILABLECHILDID" DataType="Guid" Caption="Unavilable child" />
            <c:FormField FieldID="DOUBLESPONSOREDCHILDID" DataType="Guid" Caption="Double sponsored child" />
            <c:FormField FieldID="TRANSFERCHILDID" DataType="Guid" Caption="Transferchild" />
            <c:FormField FieldID="PREVIOUSCHILDPROJECTID" DataType="Guid" Caption="Previous child project" />
            <c:FormField FieldID="PREVIOUSBIRTHDATE" DataType="Date" Caption="Previous birthdate" />
            <c:FormField FieldID="PREVIOUSNAME" MaxLength="150" Caption="Previous name" Multiline="true" />
			<c:FormField FieldID="CHILDREN" Caption="Children" >
				<c:Collection>
					<c:Fields>
						<c:FormField FieldID="ID" DataType="Guid" Hidden="true" />
						<c:FormField FieldID="CHILDLOOKUPID" Caption="Child ID" DataType="String" />
						<c:FormField FieldID="SPONSORSHIPOPPORTUNITYCHILDID" Caption="Child Name" DataType="Guid" Hidden="false">
							<c:SearchList SearchListID="AB076868-114A-4696-AFE9-8D590677708C" />
						</c:FormField>
					</c:Fields>
				</c:Collection>
			</c:FormField>
        </c:FormFields>
        <c:FormUIComponent />
    </c:FormMetaData>

	<c:DataFormExtension DataFormInstanceID="ab3b9569-4c7c-4646-a793-347856753b60" RenderStyle="Tab" TabCaption="Additional Info" />
	
</EditDataFormTemplateSpec>